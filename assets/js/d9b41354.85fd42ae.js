"use strict";(self.webpackChunktimistudio_docs=self.webpackChunktimistudio_docs||[]).push([[5274],{3905:function(e,n,t){t.d(n,{Zo:function(){return d},kt:function(){return m}});var r=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s=r.createContext({}),c=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},d=function(e){var n=c(e.components);return r.createElement(s.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},u=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=c(t),m=o,f=u["".concat(s,".").concat(m)]||u[m]||p[m]||i;return t?r.createElement(f,a(a({ref:n},d),{},{components:t})):r.createElement(f,a({ref:n},d))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var i=t.length,a=new Array(i);a[0]=u;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,a[1]=l;for(var c=2;c<i;c++)a[c]=t[c];return r.createElement.apply(null,a)}return r.createElement.apply(null,t)}u.displayName="MDXCreateElement"},5906:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return c},toc:function(){return d},default:function(){return u}});var r=t(7462),o=t(3366),i=(t(7294),t(3905)),a=["components"],l={sidebar_position:4},s="Setup Api Server (React Native)",c={unversionedId:"monsy/setup_api_server",id:"monsy/setup_api_server",title:"Setup Api Server (React Native)",description:"1. Install docker",source:"@site/docs/monsy/setup_api_server.md",sourceDirName:"monsy",slug:"/monsy/setup_api_server",permalink:"/docs/monsy/setup_api_server",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Monsy (Expo)",permalink:"/docs/monsy/expo-version"},next:{title:"Introduction",permalink:"/docs/petlove/introduction"}},d=[{value:"1. Install docker",id:"1-install-docker",children:[{value:"Set up the repository",id:"set-up-the-repository",children:[],level:3},{value:"Install Docker Engine",id:"install-docker-engine",children:[],level:3}],level:2},{value:"2. Install docker-compose",id:"2-install-docker-compose",children:[{value:"Check version docker compose:",id:"check-version-docker-compose",children:[],level:3}],level:2},{value:"3. Install nginx",id:"3-install-nginx",children:[{value:"Installing Nginx",id:"installing-nginx",children:[],level:3},{value:"Adjusting the Firewall",id:"adjusting-the-firewall",children:[],level:3},{value:"Checking your Web Server",id:"checking-your-web-server",children:[],level:3}],level:2},{value:"4. Setup nginx",id:"4-setup-nginx",children:[],level:2},{value:"5. Run docker",id:"5-run-docker",children:[{value:"Add file zip source code in server",id:"add-file-zip-source-code-in-server",children:[],level:3},{value:"Run docker",id:"run-docker",children:[],level:3}],level:2},{value:"6. Point domain",id:"6-point-domain",children:[],level:2},{value:"7. Domain for setup ssl",id:"7-domain-for-setup-ssl",children:[],level:2}],p={toc:d};function u(e){var n=e.components,t=(0,o.Z)(e,a);return(0,i.kt)("wrapper",(0,r.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"setup-api-server-react-native"},"Setup Api Server (React Native)"),(0,i.kt)("h2",{id:"1-install-docker"},"1. Install docker"),(0,i.kt)("p",null,"Before you install Docker Engine for the first time on a new host machine, you need to set up the Docker repository. Afterward, you can install and update Docker from the repository"),(0,i.kt)("h3",{id:"set-up-the-repository"},"Set up the repository"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'1. sudo apt-get update\n2. sudo apt-get install \\\n    ca-certificates \\\n    curl \\\n    gnupg \\\n    lsb-release\n3. echo \\\n  "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \\\n4. (lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null\n')),(0,i.kt)("h3",{id:"install-docker-engine"},"Install Docker Engine"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"1. sudo apt-get update\n2. sudo apt-get install docker-ce docker-ce-cli containerd.io\n")),(0,i.kt)("p",null,"Then check docker version in your ubuntu:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"1. docker version\n")),(0,i.kt)("p",null,"Output:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Client: Docker Engine - Community\n Version:           20.10.12\n API version:       1.41\n Go version:        go1.16.12\n Git commit:        e91ed57\n Built:             Mon Dec 13 11:45:33 2021\n OS/Arch:           linux/amd64\n Context:           default\n Experimental:      true\n\nServer: Docker Engine - Community\n Engine:\n  Version:          20.10.12\n  API version:      1.41 (minimum version 1.12)\n  Go version:       go1.16.12\n  Git commit:       459d0df\n  Built:            Mon Dec 13 11:43:42 2021\n  OS/Arch:          linux/amd64\n  Experimental:     false\n containerd:\n  Version:          1.4.13\n  GitCommit:        9cc61520f4cd876b86e77edfeb88fbcd536d1f9d\n runc:\n  Version:          1.0.3\n  GitCommit:        v1.0.3-0-gf46b6ba\n docker-init:\n  Version:          0.19.0\n  GitCommit:        de40ad0\n")),(0,i.kt)("h2",{id:"2-install-docker-compose"},"2. Install docker-compose"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"1. sudo apt update\n2. sudo apt install docker-compose\n")),(0,i.kt)("h3",{id:"check-version-docker-compose"},"Check version docker compose:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"1. docker-compose --version\n")),(0,i.kt)("p",null,"Output:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker-compose version 1.29.2, build 5becea4c\n")),(0,i.kt)("h2",{id:"3-install-nginx"},"3. Install nginx"),(0,i.kt)("h3",{id:"installing-nginx"},"Installing Nginx"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"1. sudo apt update\n2. sudo apt install nginx\n")),(0,i.kt)("h3",{id:"adjusting-the-firewall"},"Adjusting the Firewall"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"1. sudo ufw app list\n2. sudo ufw allow 'Nginx HTTP'\n3. sudo ufw allow 'OpenSSH'\n4. sudo ufw enable\n5. sudo ufw status\n")),(0,i.kt)("p",null,"The output will indicated which HTTP traffic is allowed:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Output\nStatus: active\n\nTo                         Action      From\n--                         ------      ----\nOpenSSH                    ALLOW       Anywhere\nNginx HTTP                 ALLOW       Anywhere\nOpenSSH (v6)               ALLOW       Anywhere (v6)\nNginx HTTP (v6)            ALLOW       Anywhere (v6)\n")),(0,i.kt)("h3",{id:"checking-your-web-server"},"Checking your Web Server"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"1. systemctl status nginx\n")),(0,i.kt)("p",null,"Output:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Output\n\u25cf nginx.service - A high performance web server and a reverse proxy server\n   Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)\n   Active: active (running) since Fri 2020-04-20 16:08:19 UTC; 3 days ago\n     Docs: man:nginx(8)\n Main PID: 2369 (nginx)\n    Tasks: 2 (limit: 1153)\n   Memory: 3.5M\n   CGroup: /system.slice/nginx.service\n           \u251c\u25002369 nginx: master process /usr/sbin/nginx -g daemon on; master_process on;\n           \u2514\u25002380 nginx: worker process\n")),(0,i.kt)("h2",{id:"4-setup-nginx"},"4. Setup nginx"),(0,i.kt)("p",null,"Make a reverse proxy to redirect request to NodeJS Server (Docker)"),(0,i.kt)("p",null,"Edit file ",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/nginx/sites-available/default")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"server {\n    root /var/www/html;\n\n    index index.html index.htm index.nginx-debian.html;\n    server_name demo-api.timistudio.dev;\n\n  # Reverse proxy\n  location / {\n    proxy_pass http://localhost:3000;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection 'upgrade';\n    proxy_set_header Host $host;\n    proxy_cache_bypass $http_upgrade;\n  }\n}\n")),(0,i.kt)("h2",{id:"5-run-docker"},"5. Run docker"),(0,i.kt)("h3",{id:"add-file-zip-source-code-in-server"},"Add file zip source code in server"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"1. scp <file zip name> user@host:/path/to/destination (Example: scp monsy.zip root@178.128.119.80:/root)\n2. sudo apt install unzip\n3. unzip <file zip name> (Example: unzip monsy.zip)\n4. cd <folder code> (Example: cd monsy)\n")),(0,i.kt)("h3",{id:"run-docker"},"Run docker"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"1. docker-composer up -d\n\n")),(0,i.kt)("h2",{id:"6-point-domain"},"6. Point domain"),(0,i.kt)("p",null,"Get global ip, in our vps, it is ",(0,i.kt)("inlineCode",{parentName:"p"},"178.128.119.80")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$ ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host\n       valid_lft forever preferred_lft forever\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000\n    link/ether 7e:8b:c2:e5:07:e2 brd ff:ff:ff:ff:ff:ff\n    inet 178.128.119.80/20 brd 178.128.127.255 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet 10.15.0.6/16 brd 10.15.255.255 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::7c8b:c2ff:fee5:7e2/64 scope link\n       valid_lft forever preferred_lft forever\n")),(0,i.kt)("p",null,"Create A record point to your global IP. Below is sample we point subdomain ",(0,i.kt)("inlineCode",{parentName:"p"},"demo-api")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"178.128.119.80")),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/47516405/158398396-c2b614bb-90f0-4aca-8ae6-8077b8cc8021.png",alt:"image"})),(0,i.kt)("h2",{id:"7-domain-for-setup-ssl"},"7. Domain for setup ssl"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$ sudo apt install certbot python3-certbot-nginx\n\n$ sudo systemctl reload nginx\n\n$ sudo certbot --nginx -d demo-api.timistudio.dev\nSaving debug log to /var/log/letsencrypt/letsencrypt.log\nPlugins selected: Authenticator nginx, Installer nginx\nEnter email address (used for urgent renewal and security notices) (Enter 'c' to\ncancel): minhdq@timistudio.dev\n\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nPlease read the Terms of Service at\nhttps://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf. You must\nagree in order to register with the ACME server at\nhttps://acme-v02.api.letsencrypt.org/directory\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n(A)gree/(C)ancel: A\n\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nWould you be willing to share your email address with the Electronic Frontier\nFoundation, a founding partner of the Let's Encrypt project and the non-profit\norganization that develops Certbot? We'd like to send you email about our work\nencrypting the web, EFF news, campaigns, and ways to support digital freedom.\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n(Y)es/(N)o: A\n(Y)es/(N)o: A\n(Y)es/(N)o: Y\nObtaining a new certificate\nPerforming the following challenges:\nhttp-01 challenge for demo-api.timistudio.dev\nWaiting for verification...\nCleaning up challenges\nDeploying Certificate to VirtualHost /etc/nginx/sites-enabled/default\n\nPlease choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n1: No redirect - Make no further changes to the webserver configuration.\n2: Redirect - Make all requests redirect to secure HTTPS access. Choose this for\nnew sites, or if you're confident your site works on HTTPS. You can undo this\nchange by editing your web server's configuration.\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nSelect the appropriate number [1-2] then [enter] (press 'c' to cancel): 2\nRedirecting all traffic on port 80 to ssl in /etc/nginx/sites-enabled/default\n\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nCongratulations! You have successfully enabled https://demo-api.timistudio.dev\n\nYou should test your configuration at:\nhttps://www.ssllabs.com/ssltest/analyze.html?d=demo-api.timistudio.dev\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\nIMPORTANT NOTES:\n - Congratulations! Your certificate and chain have been saved at:\n   /etc/letsencrypt/live/demo-api.timistudio.dev/fullchain.pem\n   Your key file has been saved at:\n   /etc/letsencrypt/live/demo-api.timistudio.dev/privkey.pem\n   Your cert will expire on 2022-06-13. To obtain a new or tweaked\n   version of this certificate in the future, simply run certbot again\n   with the \"certonly\" option. To non-interactively renew *all* of\n   your certificates, run \"certbot renew\"\n - Your account credentials have been saved in your Certbot\n   configuration directory at /etc/letsencrypt. You should make a\n   secure backup of this folder now. This configuration directory will\n   also contain certificates and private keys obtained by Certbot so\n   making regular backups of this folder is ideal.\n - If you like Certbot, please consider supporting our work by:\n\n   Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate\n   Donating to EFF:                    https://eff.org/donate-le\n")))}u.isMDXComponent=!0}}]);